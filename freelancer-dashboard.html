<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BizLink | Freelancer Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Poppins',sans-serif;background:#050816;color:#e5e7eb}
.card-bg{background:#0f172a;border:1px solid rgba(148,163,184,.35)}
.button-gradient{background:linear-gradient(90deg,#a855f7 0%,#ec4899 100%)}
.chip{font-size:.70rem;padding:.15rem .55rem;border-radius:999px}
.chip-pending{background:#facc15;color:#1f2937}
.chip-accepted{background:#22c55e;color:#022c22}
.chip-completed{background:#38bdf8;color:#0f172a}
.scroll-y{max-height:430px;overflow-y:auto}
.input-dark{background:#020617;border:1px solid #1f2937;color:#e5e7eb}
.badge{
font-size:.65rem;padding:.15rem .6rem;border-radius:999px;border:1px solid
}
.badge-lock{color:#facc15;border-color:#facc15}
.badge-paid{color:#22c55e;border-color:#22c55e}
</style>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
</head>

<body>

<header class="p-4 border-b border-slate-800 flex justify-between">
<h1 class="text-lg font-bold">BizLink Freelancer</h1>
<span id="email"></span>
</header>

<main class="max-w-6xl mx-auto p-4 grid grid-cols-2 gap-4">

<!-- LEFT -->
<div class="card-bg p-4 rounded-xl">
<h2 class="mb-2 font-semibold">Your Works</h2>
<div id="works" class="space-y-3 scroll-y"></div>
</div>

<!-- RIGHT CHAT -->
<div class="card-bg p-4 rounded-xl flex flex-col">
<h2 id="chatTitle">Select work</h2>
<div id="chat" class="flex-1 scroll-y mt-3 text-sm"></div>
<form id="chatForm" class="flex gap-2 mt-3">
<input id="chatInput" class="flex-1 px-3 py-2 rounded input-dark" placeholder="message"/>
<button class="button-gradient px-4 rounded">Send</button>
</form>
</div>

</main>

<script>
const API_URL="YOUR_APPS_SCRIPT_URL";

firebase.initializeApp({
apiKey:"AIzaSyBtle51gX5kHufuWZ_YVOIQdDR05kbCE5I",
authDomain:"bizlink-exchange.firebaseapp.com"
});
const auth=firebase.auth();

let email=null,currentWork=null,works=[];

function paymentBadge(w){
if(w.PaymentStatus==="Paid")
return `<span class="badge badge-paid">âœ… Paid â‚¹${w.LockedAmount||w.Budget}</span>`;
if(w.PaymentStatus==="Locked")
return `<span class="badge badge-lock">ðŸ”’ Locked â‚¹${w.LockedAmount||w.Budget}</span>`;
return `<span class="badge badge-lock">ðŸ’¤ Not locked</span>`;
}

function render(){
const box=document.getElementById("works");
box.innerHTML="";
works.forEach(w=>{
box.innerHTML+=`
<div class="card-bg p-3 rounded">
<b>${w.Title}</b>
<p class="text-xs">â‚¹${w.Budget} â€¢ ${w.WorkID}</p>
${paymentBadge(w)}
<div class="mt-2 flex gap-2">
<button onclick="openChat('${w.WorkID}')" class="border px-2 rounded">Chat</button>
<button onclick="requestWork('${w.WorkID}')" class="border px-2 rounded text-purple-400">Request Work</button>
</div>
</div>`;
});
}

async function load(){
const r=await fetch(`${API_URL}?action=listWorksForFreelancer&freelancerEmail=${email}`);
const j=await r.json();
works=j.works||[];
render();
}

async function requestWork(id){
const cover=prompt("Cover note (optional)")||"";
const portfolio=prompt("Portfolio URL (optional)")||"";

const f=new URLSearchParams();
f.append("action","requestWork");
f.append("WorkID",id);
f.append("freelancerEmail",email);
f.append("coverNote",cover);
f.append("portfolioURL",portfolio);

await fetch(API_URL,{method:"POST",body:f});
alert("âœ… Request sent to owner");
}

function openChat(id){
currentWork=id;
document.getElementById("chatTitle").innerText=id;
}

document.getElementById("chatForm").onsubmit=e=>{
e.preventDefault();
if(!currentWork)return;
const text=chatInput.value;
chatInput.value="";
fetch(API_URL,{method:"POST",body:new URLSearchParams({
action:"sendMessage",
WorkID:currentWork,
FromRole:"Freelancer",
FromEmail:email,
Message:text
})});
};

auth.onAuthStateChanged(u=>{
if(!u)return location="login.html";
email=u.email;
document.getElementById("email").innerText=email;
load();
});
</script>

</body>
</html>
