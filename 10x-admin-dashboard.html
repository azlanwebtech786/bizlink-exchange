<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BizLink 10X â€“ Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;background:#050816;color:#e5e7eb}
.card{background:#0f172a;border:1px solid rgba(148,163,184,.2)}
.modal-bg{background:rgba(2,6,23,.9)}
.modal{background:#020617}
</style>
</head>

<body class="min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 bg-slate-950 border-b border-slate-800 z-40">
  <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
    <h1 class="font-bold text-lg text-purple-400">BizLink 10X â€“ ADMIN PANEL</h1>
    <div class="flex gap-4 items-center">
      <span class="text-sm text-slate-400">admin@bizlink.in</span>
      <button class="bg-red-600 px-4 py-1.5 rounded text-sm">Logout</button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 py-8 space-y-10">

<!-- STATS -->
<section class="grid md:grid-cols-4 gap-4">
  <div class="card p-4 rounded">Active Clients<br><b id="statClients" class="text-2xl">â€”</b></div>
  <div class="card p-4 rounded">Freelancers<br><b id="statFreelancers" class="text-2xl">â€”</b></div>
  <div class="card p-4 rounded">Today Tasks<br><b id="statTasks" class="text-2xl">â€”</b></div>
  <div class="card p-4 rounded">Pending Proofs<br><b id="statPending" class="text-2xl text-yellow-400">â€”</b></div>
</section>

<!-- PLAN RULES -->
<section>
<h2 class="text-lg font-semibold mb-3">Plan Task Rules (Auto Assignment)</h2>
<div class="card rounded overflow-hidden">
<table class="w-full text-sm">
<thead class="bg-slate-800">
<tr>
<th class="p-3">Plan</th>
<th class="p-3">Task</th>
<th class="p-3">Frequency</th>
<th class="p-3">Freelancer</th>
<th class="p-3">Action</th>
</tr>
</thead>
<tbody id="planRulesBody"></tbody>
</table>
</div>

<div class="grid md:grid-cols-5 gap-3 mt-4">
<select id="rulePlan" class="p-2 bg-slate-900 rounded">
  <option>10X Grow Lab</option>
</select>
<select id="ruleTask" class="p-2 bg-slate-900 rounded">
  <option>Instagram Reel</option>
  <option>Google Business Post</option>
  <option>WhatsApp Follow-up</option>
  <option>Review Collection</option>
</select>
<select id="ruleFrequency" class="p-2 bg-slate-900 rounded">
  <option>Daily</option>
</select>
<select id="ruleFreelancer" class="p-2 bg-slate-900 rounded"></select>
<button onclick="savePlanRule()" class="bg-purple-600 rounded px-4 py-2 font-semibold">
Save Rule
</button>
</div>
</section>

<!-- CLIENT LIST -->
<section>
<h2 class="text-lg font-semibold mb-3">Client Master Control</h2>
<div class="card rounded overflow-hidden">
<table class="w-full text-sm">
<thead class="bg-slate-800">
<tr>
<th class="p-3">Client</th>
<th class="p-3">Plan</th>
<th class="p-3">Status</th>
<th class="p-3">Progress</th>
<th class="p-3">Action</th>
</tr>
</thead>
<tbody id="clientTableBody"></tbody>
</table>
</div>
</section>

</main>

<!-- CLIENT MODAL -->
<div id="clientModal" class="fixed inset-0 hidden modal-bg flex items-center justify-center z-50">
<div class="modal w-full max-w-3xl rounded-xl p-6 relative">

<button onclick="closeClient()" class="absolute top-3 right-4 text-xl">âœ•</button>

<h3 id="modalClientName" class="text-xl font-bold"></h3>
<p id="modalClientEmail" class="text-xs text-slate-400 mb-4"></p>

<div class="card rounded overflow-hidden">
<table class="w-full text-sm">
<thead class="bg-slate-800">
<tr>
<th class="p-3">Task</th>
<th class="p-3">Freelancer</th>
<th class="p-3">Status</th>
<th class="p-3">Action</th>
</tr>
</thead>
<tbody id="clientTaskBody"></tbody>
</table>
</div>

</div>
</div>

<script>
/* ðŸ”¥ API URL */
const API_URL = "https://script.google.com/macros/s/AKfycbyCKg6L51ayJOendAiK_FEWwC4v_Cm4oETucMJcApPj5qCFZuJPY4HOfDI0M3dD1bfOGg/exec";

/* ===== STATS ===== */
async function loadAdminStats(){
  const r = await fetch(`${API_URL}?action=getAdminStats`);
  const d = await r.json();
  statClients.innerText = d.clients;
  statFreelancers.innerText = d.freelancers;
  statTasks.innerText = d.todayTasks;
  statPending.innerText = d.pendingProofs;
}

/* ===== FREELANCERS ===== */
async function loadFreelancers(){
  const r = await fetch(`${API_URL}?action=getFreelancers`);
  const d = await r.json();
  ruleFreelancer.innerHTML = "";
  d.freelancers.forEach(f=>{
    ruleFreelancer.innerHTML += `<option value="${f.email}">${f.email}</option>`;
  });
}

/* ===== PLAN RULES ===== */
async function loadPlanRules(){
  const r = await fetch(`${API_URL}?action=getPlanRules`);
  const d = await r.json();
  planRulesBody.innerHTML="";
  d.rules.forEach(r=>{
    planRulesBody.innerHTML += `
    <tr>
      <td class="p-3">${r.plan}</td>
      <td class="p-3">${r.task}</td>
      <td class="p-3">${r.frequency}</td>
      <td class="p-3">${r.freelancer}</td>
      <td class="p-3">â€”</td>
    </tr>`;
  });
}

async function savePlanRule(){
  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"savePlanRule",
      plan:rulePlan.value,
      task:ruleTask.value,
      frequency:ruleFrequency.value,
      freelancerEmail:ruleFreelancer.value
    })
  });
  alert("Rule saved");
  loadPlanRules();
}

/* ===== CLIENTS ===== */
async function loadClients(){
  const r = await fetch(`${API_URL}?action=getAllClients`);
  const d = await r.json();
  clientTableBody.innerHTML="";
  d.clients.forEach(c=>{
    clientTableBody.innerHTML+=`
    <tr>
      <td class="p-3">${c.name}<br><span class="text-xs">${c.email}</span></td>
      <td class="p-3">${c.plan}</td>
      <td class="p-3 text-green-400">${c.status}</td>
      <td class="p-3">${c.progress}</td>
      <td class="p-3">
        <button onclick="openClient('${c.clientId}')" class="bg-purple-600 px-3 py-1 rounded text-xs">
        View
        </button>
      </td>
    </tr>`;
  });
}

/* ===== CLIENT MODAL ===== */
async function openClient(id){
  const r = await fetch(`${API_URL}?action=getClientAdminView&clientId=${id}`);
  const d = await r.json();

  modalClientName.innerText = d.client.name;
  modalClientEmail.innerText = d.client.email;
  clientTaskBody.innerHTML="";

  d.tasks.forEach(t=>{
    clientTaskBody.innerHTML+=`
    <tr>
      <td class="p-3">${t.task}</td>
      <td class="p-3">${t.freelancer}</td>
      <td class="p-3">${t.status}</td>
      <td class="p-3">
        <button onclick="approveTask('${t.taskId}')" class="bg-green-600 px-2 py-1 text-xs rounded">Approve</button>
        <button onclick="rejectTask('${t.taskId}')" class="bg-red-600 px-2 py-1 text-xs rounded">Reject</button>
      </td>
    </tr>`;
  });

  clientModal.classList.remove("hidden");
}

function closeClient(){ clientModal.classList.add("hidden"); }

async function approveTask(id){
  await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"approveTask",taskId:id})});
  alert("Approved");
}

async function rejectTask(id){
  await fetch(API_URL,{method:"POST",body:JSON.stringify({action:"rejectTask",taskId:id})});
  alert("Rejected");
}

/* INIT */
window.onload=()=>{
  loadAdminStats();
  loadFreelancers();
  loadPlanRules();
  loadClients();
};
</script>

</body>
</html>
