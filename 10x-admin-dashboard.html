<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bizlink 10X ‚Äì Admin Control Room</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body{font-family:Poppins;background:#0b1220;color:#fff;margin:0;padding:20px}
.card{background:#111827;padding:20px;border-radius:12px;margin-bottom:20px}
h2{margin-top:0}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #333;text-align:left}
button{padding:6px 12px;border:none;border-radius:6px;cursor:pointer}
.active{background:#065f46}
.deactive{background:#7f1d1d}
select{padding:6px;border-radius:6px;background:#0b1220;color:#fff}
</style>
</head>

<body>

<div class="card">
  <h2>Bizlink 10X ‚Äì Admin Control Room</h2>
</div>

<div class="card">
  <h3>üë§ Clients</h3>
  <table id="clientsTable">
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Status</th><th>Expert</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="card">
  <h3>üßë‚Äçüíº Experts</h3>
  <table id="expertsTable">
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Status</th><th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="card">
  <h3>üìã All Works Monitor</h3>
  <table id="worksTable">
    <thead>
      <tr>
        <th>Client</th><th>Work</th><th>Status</th><th>Month</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyN0Y-GzDaDrje8fxRSm2WTUYpj1B7LbBAIEeVKlfvIagXanj5TA2P8QUbjL0Tx-kmNHw/exec";

async function loadAdmin(){
  const res = await fetch(API_URL+"?admin=dashboard");
  const data = await res.json();

  renderClients(data.clients, data.experts);
  renderExperts(data.experts);
  renderWorks(data.works);
}

function renderClients(clients, experts){
  const tbody=document.querySelector("#clientsTable tbody");
  tbody.innerHTML="";

  clients.forEach(c=>{
    const tr=document.createElement("tr");

    const expertOptions = experts.map(e=>
      `<option value="${e[0]}" ${e[0]==c[4]?'selected':''}>${e[1]}</option>`
    ).join("");

    tr.innerHTML=`
      <td>${c[0]}</td>
      <td>${c[1]}</td>
      <td>${c[3]}</td>
      <td>
        <select onchange="assignExpert('${c[0]}',this.value)">
          ${expertOptions}
        </select>
      </td>
      <td>
        <button class="${c[3]=='Active'?'deactive':'active'}"
          onclick="toggleClient('${c[0]}','${c[3]=='Active'?'De-active':'Active'}')">
          ${c[3]=='Active'?'De-active':'Activate'}
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function renderExperts(experts){
  const tbody=document.querySelector("#expertsTable tbody");
  tbody.innerHTML="";

  experts.forEach(e=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${e[0]}</td>
      <td>${e[1]}</td>
      <td>${e[2]}</td>
      <td>
        <button class="${e[2]=='Active'?'deactive':'active'}"
          onclick="toggleExpert('${e[0]}','${e[2]=='Active'?'De-active':'Active'}')">
          ${e[2]=='Active'?'De-active':'Activate'}
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function renderWorks(works){
  const tbody=document.querySelector("#worksTable tbody");
  tbody.innerHTML="";

  works.forEach(w=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${w[0]}</td>
      <td>${w[1]}</td>
      <td>${w[2]}</td>
      <td>${w[3]}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function toggleClient(id,status){
  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"toggleClient",
      clientId:id,
      status:status
    })
  });
  loadAdmin();
}

async function toggleExpert(id,status){
  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"toggleExpert",
      expertId:id,
      status:status
    })
  });
  loadAdmin();
}

async function assignExpert(cid,eid){
  await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"assignExpert",
      clientId:cid,
      expertId:eid
    })
  });
}

loadAdmin();
</script>

</body>
</html>
