<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BizLink 10X â€“ Freelancer Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;background:#020617;color:#e5e7eb}
.card{background:#0b1220;border:1px solid rgba(148,163,184,.25)}
</style>
</head>

<body class="min-h-screen">

<!-- HEADER -->
<header class="sticky top-0 bg-slate-950 border-b border-slate-800 z-40">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <h1 class="font-bold text-lg text-purple-400">10X Freelancer Dashboard</h1>
    <div class="flex gap-3 items-center">
      <span id="freelancerEmail" class="text-sm text-slate-400"></span>
      <button onclick="logout()" class="bg-red-600 px-4 py-1.5 rounded text-sm">Logout</button>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-6xl mx-auto px-4 py-8 space-y-6">

<section class="card rounded-xl p-5">
  <h2 class="text-lg font-semibold mb-3">Todayâ€™s Assigned Tasks</h2>

  <table class="w-full text-sm">
    <thead class="bg-slate-800">
      <tr>
        <th class="p-3 text-left">Task</th>
        <th class="p-3">Status</th>
        <th class="p-3">Proof</th>
      </tr>
    </thead>
    <tbody id="taskTable" class="bg-slate-900">
      <tr>
        <td colspan="3" class="p-6 text-center text-slate-400">Loading tasksâ€¦</td>
      </tr>
    </tbody>
  </table>
</section>

</main>

<script>
/* ðŸ”´ APPS SCRIPT URL */
const API_URL = "https://script.google.com/macros/s/AKfycbzVzT1y0uSX2wmI1uKqUq81RGmbfuWcG_6V7JV2_1vcGGJ_YE2kBs42mN0VENsRcmp94w/exec";

/* LOGIN EMAIL */
const email = localStorage.getItem("email");
if(!email) location.href="login.html";
document.getElementById("freelancerEmail").innerText = email;

/* LOAD TASKS */
async function loadTasks(){
  const table = document.getElementById("taskTable");
  table.innerHTML = "";

  try{
    const res = await fetch(
      `${API_URL}?action=getFreelancerTasks&email=${encodeURIComponent(email)}`
    );
    const data = await res.json();

    if(!data.ok || data.tasks.length===0){
      table.innerHTML = `
        <tr><td colspan="3" class="p-6 text-center text-slate-400">
        No tasks assigned today
        </td></tr>`;
      return;
    }

    data.tasks.forEach(t=>{
      let action = "â€”";

      if(t.status==="PENDING" || t.status==="REJECTED"){
        action = `
          <input type="text" placeholder="Paste proof link"
            class="bg-slate-800 px-2 py-1 rounded text-xs w-40"
            id="proof-${t.taskId}">
          <button onclick="submitProof('${t.taskId}')"
            class="bg-purple-600 px-2 py-1 rounded text-xs ml-1">
            Submit
          </button>`;
      }
      else if(t.status==="SUBMITTED"){
        action = `<span class="text-yellow-400">Waiting</span>`;
      }
      else if(t.status==="COMPLETED"){
        action = `<span class="text-green-400">Approved</span>`;
      }

      table.innerHTML += `
        <tr class="border-b border-slate-800">
          <td class="p-3">${t.task}</td>
          <td class="p-3 font-semibold">${t.status}</td>
          <td class="p-3">${action}</td>
        </tr>`;
    });

  }catch(e){
    table.innerHTML = `
      <tr><td colspan="3" class="p-6 text-center text-red-400">
      API Error
      </td></tr>`;
  }
}

/* SUBMIT PROOF */
async function submitProof(taskId){
  const proof = document.getElementById("proof-"+taskId).value.trim();
  if(!proof) return alert("Proof link required");

  const res = await fetch(API_URL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      action:"submitTaskProof",
      taskId,
      proof
    })
  });

  const data = await res.json();
  if(data.ok){
    alert("Proof submitted");
    loadTasks();
  }else{
    alert("Error submitting proof");
  }
}

function logout(){
  localStorage.removeItem("email");
  location.href="login.html";
}

loadTasks();
</script>

</body>
</html>
