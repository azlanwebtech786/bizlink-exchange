<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up | BizLink Exchange</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 text-white">

    <div class="max-w-md w-full p-8 rounded-2xl glass-card shadow-lg">
        <h1 class="text-3xl font-bold text-center mb-6">Create Your Account</h1>
        
        <form id="signupForm" class="space-y-4">
            <input type="email" id="email" placeholder="Enter your email" required
                   class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-200 outline-none focus:bg-white/30">
            
            <input type="password" id="password" placeholder="Create a password (min. 6 chars)" required
                   class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-200 outline-none focus:bg-white/30">

            <!-- NEW: Role selection -->
            <div class="space-y-2 text-sm mt-2">
                <p class="text-center text-gray-100">Choose your role</p>
                <div class="flex flex-col gap-2 text-xs">
                    <label class="flex items-center gap-2">
                        <input type="radio" name="role" value="freelancer" checked class="accent-red-500">
                        <span>Freelancer (kaam lene ke liye)</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="radio" name="role" value="owner" class="accent-red-500">
                        <span>Business Owner (Post a Work / Owner Dashboard)</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="radio" name="role" value="biz10x" class="accent-red-500">
                        <span>10X Grow Lab (Growth System)</span>
                    </label>
                </div>
            </div>
            
            <button type="submit" id="submitBtn"
                    class="w-full py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition">
                Create Account
            </button>
        </form>
        
        <p id="status" class="mt-4 text-center font-medium"></p>
        <p class="mt-4 text-center text-gray-200">
            Already have an account? <a href="login.html" class="text-red-300 hover:underline">Log In</a>
        </p>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <script>
       // For Firebase JS SDK v7.20.0 and later, measurementId is optional
       const firebaseConfig = {
          apiKey: "AIzaSyBtle51gX5kHufuWZ_YVOIQdDR05kbCE5I",
          authDomain: "bizlink-exchange.firebaseapp.com",
          projectId: "bizlink-exchange",
          storageBucket: "bizlink-exchange.firebasestorage.app",
          messagingSenderId: "116213651971",
          appId: "1:116213651971:web:fff60961af0c4da3448c36",
          measurementId: "G-VQ3JM82D1N"
       };

       // Apps Script URL (same as dashboards)
       const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwh86jupkABs5rFaR87_q3Vu77lEUnjud4U1Zzh63R-GHf_60KAF6ijFUOC9-rgDqJZyA/exec";

       // Firebase initialize
       firebase.initializeApp(firebaseConfig);
       const auth = firebase.auth(); // Authentication service

       // Form elements
       const signupForm = document.getElementById('signupForm');
       const emailInput = document.getElementById('email');
       const passwordInput = document.getElementById('password');
       const submitBtn = document.getElementById('submitBtn');
       const statusEl = document.getElementById('status');

       // Helper: call Apps Script to save user profile + role
       async function saveUserProfile(email, role) {
         try {
           const body = new URLSearchParams();
           body.append('action', 'setUserProfile');
           body.append('email', email);
           body.append('role', role);

           await fetch(SCRIPT_URL, {
             method: 'POST',
             headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
             body: body.toString()
           });
         } catch (err) {
           console.warn('setUserProfile error', err);
         }
       }

       // Form submit
       signupForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Page reload rokna

            const email = emailInput.value.trim();
            const password = passwordInput.value;
            const roleInput = document.querySelector('input[name="role"]:checked');
            const role = roleInput ? roleInput.value : '';

            submitBtn.disabled = true;
            submitBtn.innerText = 'Creating account...';
            statusEl.innerText = '';

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);

                // Role + profile Apps Script me save karo
                if (role) {
                  saveUserProfile(email, role); // fire-and-forget
                }

                statusEl.style.color = 'lightgreen';
                statusEl.innerText = '✅ Account created successfully! Redirecting to login...';

                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            } catch (error) {
                statusEl.style.color = 'pink';
                statusEl.innerText = `❌ Error: ${error.message}`;
                submitBtn.disabled = false;
                submitBtn.innerText = 'Create Account';
            }
       });
    </script>

</body>
</html>
