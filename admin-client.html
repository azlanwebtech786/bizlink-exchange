<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BizLink 10X ‚Äì Client Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:Poppins;
  background:#020617;
  color:#e5e7eb;
}
.card{
  background:#0b1220;
  border:1px solid rgba(148,163,184,.25);
}
.btn{
  padding:.5rem 1rem;
  border-radius:.4rem;
  font-weight:600;
  font-size:.85rem;
}
</style>
</head>

<body class="min-h-screen">

<!-- HEADER -->
<header class="bg-slate-950 border-b border-slate-800">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <button onclick="goBack()" class="text-purple-400 text-sm">‚Üê Back</button>
    <h1 class="font-bold">Client Control</h1>
    <span class="text-sm text-slate-400">Admin</span>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6 space-y-6">

<!-- CLIENT INFO -->
<section class="grid sm:grid-cols-3 gap-4">
  <div class="card p-4 rounded">
    <p class="text-xs text-slate-400">Client</p>
    <h2 id="clientName" class="font-semibold">‚Äî</h2>
    <p id="clientEmail" class="text-xs text-slate-400">‚Äî</p>
  </div>
  <div class="card p-4 rounded">
    <p class="text-xs text-slate-400">Plan</p>
    <h2 id="clientPlan" class="font-semibold">‚Äî</h2>
    <p id="clientStatus" class="text-green-400 text-sm">‚Äî</p>
  </div>
  <div class="card p-4 rounded">
    <p class="text-xs text-slate-400">Today Tasks</p>
    <h2 id="taskCount" class="text-2xl font-bold">0</h2>
  </div>
</section>

<!-- TASK TABLE -->
<section>
  <h2 class="font-semibold mb-2">Today Tasks & Proofs</h2>
  <div class="card rounded overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-slate-800">
        <tr>
          <th class="px-4 py-2 text-left">Task</th>
          <th class="px-4 py-2">Freelancer</th>
          <th class="px-4 py-2">Status</th>
          <th class="px-4 py-2">Proof</th>
          <th class="px-4 py-2">Action</th>
        </tr>
      </thead>
      <tbody id="taskTable" class="bg-slate-900">
        <tr>
          <td colspan="5" class="text-center p-6 text-slate-400">Loading...</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

</main>

<script>
/* üî¥ CHANGE THIS */
const API = "https://script.google.com/macros/s/AKfycbyCKg6L51ayJOendAiK_FEWwC4v_Cm4oETucMJcApPj5qCFZuJPY4HOfDI0M3dD1bfOGg/exec";

/* PARAMS */
const params = new URLSearchParams(window.location.search);
const clientId = params.get("clientId");
const email = params.get("email");

/* LOAD CLIENT DASHBOARD */
async function loadClient() {
  const res = await fetch(`${API}?action=getClientDashboard&email=${encodeURIComponent(email)}`);
  const data = await res.json();

  if (!data.ok) {
    alert("Client not found");
    return;
  }

  document.getElementById("clientName").innerText = data.client.name;
  document.getElementById("clientEmail").innerText = email;
  document.getElementById("clientPlan").innerText = data.client.plan;
  document.getElementById("clientStatus").innerText = data.client.status;
  document.getElementById("taskCount").innerText = data.todayTasks.length;

  const table = document.getElementById("taskTable");
  table.innerHTML = "";

  if (data.todayTasks.length === 0) {
    table.innerHTML = `
      <tr>
        <td colspan="5" class="text-center p-6 text-slate-400">No tasks today</td>
      </tr>`;
    return;
  }

  data.todayTasks.forEach(t => {
    table.innerHTML += `
      <tr class="border-b border-slate-800">
        <td class="px-4 py-2">${t.task}</td>
        <td class="px-4 py-2">${t.assignedTo || "-"}</td>
        <td class="px-4 py-2 text-yellow-400">${t.status}</td>
        <td class="px-4 py-2">
          ${t.proof ? `<a href="${t.proof}" target="_blank" class="text-purple-400 underline">View</a>` : "-"}
        </td>
        <td class="px-4 py-2 space-x-2">
          ${t.status === "SUBMITTED" ? `
            <button class="btn bg-green-600" onclick="approve('${t.taskId}')">Approve</button>
            <button class="btn bg-red-600" onclick="reject('${t.taskId}')">Reject</button>
          ` : "-"}
        </td>
      </tr>`;
  });
}

/* APPROVE / REJECT */
async function approve(taskId) {
  await fetch(API, {
    method:"POST",
    body:JSON.stringify({ action:"submitTaskProof", taskId })
  });
  loadClient();
}

async function reject(taskId) {
  alert("Rejected (logic can be added)");
}

/* BACK */
function goBack(){
  window.history.back();
}

loadClient();
</script>

</body>
</html>
